--- net/minecraft/world/entity/monster/EnderMan.java
+++ net/minecraft/world/entity/monster/EnderMan.java
@@ -16,20 +16,23 @@
 import net.minecraft.network.syncher.SynchedEntityData;
 import net.minecraft.sounds.SoundEvent;
 import net.minecraft.sounds.SoundEvents;
 import net.minecraft.tags.BlockTags;
 import net.minecraft.tags.FluidTags;
+import net.minecraft.tags.Tag;
 import net.minecraft.util.Mth;
 import net.minecraft.world.damagesource.DamageSource;
 import net.minecraft.world.damagesource.IndirectEntityDamageSource;
 import net.minecraft.world.entity.Entity;
 import net.minecraft.world.entity.EntityDimensions;
 import net.minecraft.world.entity.EntityType;
 import net.minecraft.world.entity.LivingEntity;
 import net.minecraft.world.entity.Pose;
 import net.minecraft.world.entity.ai.attributes.AttributeInstance;
 import net.minecraft.world.entity.ai.attributes.AttributeModifier;
+import net.minecraft.world.entity.ai.attributes.AttributeSupplier;
+import net.minecraft.world.entity.ai.attributes.Attributes;
 import net.minecraft.world.entity.ai.goal.FloatGoal;
 import net.minecraft.world.entity.ai.goal.Goal;
 import net.minecraft.world.entity.ai.goal.LookAtPlayerGoal;
 import net.minecraft.world.entity.ai.goal.MeleeAttackGoal;
 import net.minecraft.world.entity.ai.goal.RandomLookAroundGoal;
@@ -78,31 +81,27 @@
       this.targetSelector.addGoal(1, new EnderMan.EndermanLookForPlayerGoal(this));
       this.targetSelector.addGoal(2, new HurtByTargetGoal(this, new Class[0]));
       this.targetSelector.addGoal(3, new NearestAttackableTargetGoal(this, Endermite.class, 10, true, false, ENDERMITE_SELECTOR));
    }
 
-   protected void registerAttributes() {
-      super.registerAttributes();
-      this.getAttribute(SharedMonsterAttributes.MAX_HEALTH).setBaseValue(40.0D);
-      this.getAttribute(SharedMonsterAttributes.MOVEMENT_SPEED).setBaseValue(0.30000001192092896D);
-      this.getAttribute(SharedMonsterAttributes.ATTACK_DAMAGE).setBaseValue(7.0D);
-      this.getAttribute(SharedMonsterAttributes.FOLLOW_RANGE).setBaseValue(64.0D);
+   public static AttributeSupplier.Builder createAttributes() {
+      return Monster.createMonsterAttributes().add(Attributes.MAX_HEALTH, 40.0D).add(Attributes.MOVEMENT_SPEED, 0.30000001192092896D).add(Attributes.ATTACK_DAMAGE, 7.0D).add(Attributes.FOLLOW_RANGE, 64.0D);
    }
 
    public void setTarget(@Nullable LivingEntity var1) {
       super.setTarget(var1);
-      AttributeInstance var2 = this.getAttribute(SharedMonsterAttributes.MOVEMENT_SPEED);
+      AttributeInstance var2 = this.getAttribute(Attributes.MOVEMENT_SPEED);
       if (var1 == null) {
          this.targetChangeTime = 0;
          this.entityData.set(DATA_CREEPY, false);
          this.entityData.set(DATA_STARED_AT, false);
          var2.removeModifier(SPEED_MODIFIER_ATTACKING);
       } else {
          this.targetChangeTime = this.tickCount;
          this.entityData.set(DATA_CREEPY, true);
          if (!var2.hasModifier(SPEED_MODIFIER_ATTACKING)) {
-            var2.addModifier(SPEED_MODIFIER_ATTACKING);
+            var2.addTransientModifier(SPEED_MODIFIER_ATTACKING);
          }
       }
 
    }
 
@@ -187,11 +186,11 @@
          this.hurt(DamageSource.DROWN, 1.0F);
       }
 
       if (this.level.isDay() && this.tickCount >= this.targetChangeTime + 600) {
          float var1 = this.getBrightness();
-         if (var1 > 0.5F && this.level.canSeeSky(new BlockPos(this)) && this.random.nextFloat() * 30.0F < (var1 - 0.4F) * 2.0F) {
+         if (var1 > 0.5F && this.level.canSeeSky(this.blockPosition()) && this.random.nextFloat() * 30.0F < (var1 - 0.4F) * 2.0F) {
             this.setTarget((LivingEntity)null);
             this.teleport();
          }
       }
 
@@ -229,11 +228,11 @@
       BlockState var8 = this.level.getBlockState(var7);
       boolean var9 = var8.getMaterial().blocksMotion();
       boolean var10 = var8.getFluidState().is(FluidTags.WATER);
       if (var9 && !var10) {
          boolean var11 = this.randomTeleport(var1, var3, var5, true);
-         if (var11) {
+         if (var11 && !this.isSilent()) {
             this.level.playSound((Player)null, this.xo, this.yo, this.zo, SoundEvents.ENDERMAN_TELEPORT, this.getSoundSource(), 1.0F, 1.0F);
             this.playSound(SoundEvents.ENDERMAN_TELEPORT, 1.0F, 1.0F);
          }
 
          return var11;
@@ -273,25 +272,25 @@
    }
 
    public boolean hurt(DamageSource var1, float var2) {
       if (this.isInvulnerableTo(var1)) {
          return false;
-      } else if (!(var1 instanceof IndirectEntityDamageSource) && var1 != DamageSource.FIREWORKS) {
-         boolean var4 = super.hurt(var1, var2);
-         if (!this.level.isClientSide() && var1.isBypassArmor() && this.random.nextInt(10) != 0) {
-            this.teleport();
-         }
-
-         return var4;
-      } else {
-         for(int var3 = 0; var3 < 64; ++var3) {
+      } else if (var1 instanceof IndirectEntityDamageSource) {
+         for(int var4 = 0; var4 < 64; ++var4) {
             if (this.teleport()) {
                return true;
             }
          }
 
          return false;
+      } else {
+         boolean var3 = super.hurt(var1, var2);
+         if (!this.level.isClientSide() && this.random.nextInt(10) != 0) {
+            this.teleport();
+         }
+
+         return var3;
       }
    }
 
    public boolean isCreepy() {
       return (Boolean)this.entityData.get(DATA_CREEPY);
@@ -303,12 +302,16 @@
 
    public void setBeingStaredAt() {
       this.entityData.set(DATA_STARED_AT, true);
    }
 
+   public boolean requiresCustomPersistence() {
+      return super.requiresCustomPersistence() || this.getCarriedBlock() != null;
+   }
+
    static {
-      SPEED_MODIFIER_ATTACKING = (new AttributeModifier(SPEED_MODIFIER_ATTACKING_UUID, "Attacking speed boost", 0.15000000596046448D, AttributeModifier.Operation.ADDITION)).setSerialize(false);
+      SPEED_MODIFIER_ATTACKING = new AttributeModifier(SPEED_MODIFIER_ATTACKING_UUID, "Attacking speed boost", 0.15000000596046448D, AttributeModifier.Operation.ADDITION);
       DATA_CARRY_STATE = SynchedEntityData.defineId(EnderMan.class, EntityDataSerializers.BLOCK_STATE);
       DATA_CREEPY = SynchedEntityData.defineId(EnderMan.class, EntityDataSerializers.BOOLEAN);
       DATA_STARED_AT = SynchedEntityData.defineId(EnderMan.class, EntityDataSerializers.BOOLEAN);
       ENDERMITE_SELECTOR = (var0) -> {
          return var0 instanceof Endermite && ((Endermite)var0).isPlayerSpawned();
@@ -343,11 +346,11 @@
          Block var8 = var7.getBlock();
          Vec3 var9 = new Vec3((double)Mth.floor(this.enderman.getX()) + 0.5D, (double)var4 + 0.5D, (double)Mth.floor(this.enderman.getZ()) + 0.5D);
          Vec3 var10 = new Vec3((double)var3 + 0.5D, (double)var4 + 0.5D, (double)var5 + 0.5D);
          BlockHitResult var11 = var2.clip(new ClipContext(var9, var10, ClipContext.Block.OUTLINE, ClipContext.Fluid.NONE, this.enderman));
          boolean var12 = var11.getBlockPos().equals(var6);
-         if (var8.is(BlockTags.ENDERMAN_HOLDABLE) && var12) {
+         if (var8.is((Tag)BlockTags.ENDERMAN_HOLDABLE) && var12) {
             this.enderman.setCarriedBlock(var7);
             var2.removeBlock(var6, false);
          }
 
       }
@@ -465,10 +468,14 @@
             return this.target != null && this.continueAggroTargetConditions.test(this.enderman, this.target) ? true : super.canContinueToUse();
          }
       }
 
       public void tick() {
+         if (this.enderman.getTarget() == null) {
+            super.setTarget((LivingEntity)null);
+         }
+
          if (this.pendingTarget != null) {
             if (--this.aggroTime <= 0) {
                this.target = this.pendingTarget;
                this.pendingTarget = null;
                super.start();
